<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Aut√≥mata IoT - Magic Wand</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- OVERLAY DE AUTENTICACI√ìN -->
    <div id="auth-overlay">
        <div id="login-form" class="auth-card">
            <span class="material-icons" style="font-size: 40px; color: var(--primary-color);">lock</span>
            <h2>Iniciar Sesi√≥n</h2>
            <p style="font-size: 0.9em; color: #aaa;">Accede para controlar el aut√≥mata</p>
            <input type="text" id="log-user" class="auth-input" placeholder="Usuario">
            <input type="password" id="log-pass" class="auth-input" placeholder="Contrase√±a">
            <div id="log-error" class="error-msg"></div>
            <button class="auth-btn" onclick="login()">Entrar</button>
            <div class="toggle-text" onclick="toggleAuth()">¬øNo tienes cuenta? Reg√≠strate</div>
        </div>

        <div id="reg-form" class="auth-card" style="display: none;">
            <span class="material-icons" style="font-size: 40px; color: var(--secondary-color);">person_add</span>
            <h2>Crear Cuenta</h2>
            <input type="text" id="reg-name" class="auth-input" placeholder="Nombre Completo">
            <input type="text" id="reg-user" class="auth-input" placeholder="Usuario">
            <input type="password" id="reg-pass" class="auth-input" placeholder="Contrase√±a">
            <div id="reg-error" class="error-msg"></div>
            <button class="auth-btn" onclick="register()">Registrarse</button>
            <div class="toggle-text" onclick="toggleAuth()">¬øYa tienes cuenta? Inicia sesi√≥n</div>
        </div>
    </div>

    <!-- HEADER SUPERIOR -->
    <header>
        <div class="logo">
            <span class="material-icons">auto_fix_high</span>
            Magic Wand IoT
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <span id="user-display">Invitado</span>
            <button onclick="logout()" class="logout-btn">
                <span class="material-icons" style="font-size: 1rem; vertical-align: middle;">logout</span> Salir
            </button>
        </div>
    </header>

    <!-- LAYOUT PRINCIPAL -->
    <div class="main-layout">
        <!-- BARRA LATERAL (Con IDs para efecto QOL) -->
        <aside>
            <button id="nav-dashboard" class="nav-btn active" onclick="nav('dashboard')">
                <span class="material-icons">dashboard</span> Panel General
            </button>
            <button id="nav-trace" class="nav-btn" onclick="nav('trace')">
                <span class="material-icons">gesture</span> Dibujo de Robot
            </button>
            <button id="nav-mqtt" class="nav-btn" onclick="nav('mqtt')">
                <span class="material-icons">router</span> Dispositivos MQTT
            </button>
            <button id="nav-tutorials" class="nav-btn" onclick="nav('tutorials')">
                <span class="material-icons">menu_book</span> Tutoriales
            </button>
            <button id="nav-info" class="nav-btn" onclick="nav('info')">
                <span class="material-icons">info</span> Descripci√≥n Proyecto
            </button>
        </aside>

        <!-- √ÅREA DE CONTENIDO -->
        <main>
            
            <!-- SECCI√ìN 1: DASHBOARD -->
            <div id="dashboard" class="section active">
                <div class="card">
                    <h2>Estado del Aut√≥mata</h2>
                    <div style="display: flex; justify-content: space-around; text-align: center;">
                        <div>
                            <span class="material-icons" style="font-size: 40px; color: gold;">light_mode</span>
                            <p>Iluminaci√≥n: <strong>Lumos</strong></p>
                        </div>
                        <div>
                            <span class="material-icons" style="font-size: 40px; color: var(--success-color);">battery_std</span>
                            <p>Bater√≠a: <strong>85%</strong></p>
                        </div>
                        <div>
                            <span class="material-icons" style="font-size: 40px; color: var(--secondary-color);">wifi</span>
                            <p>MQTT: <strong>Conectado</strong></p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Historial de Comandos Recientes</h2>
                    <p style="color: #aaa; font-size: 0.9em;">Registro en tiempo real de los hechizos detectados y su descripci√≥n.</p>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Hora</th>
                                    <th>Comando Detectado</th>
                                    <th>Descripci√≥n de la Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="command-log">
                                <tr>
                                    <td colspan="3" style="text-align:center; color:#666; padding: 20px;">
                                        Esperando actividad m√°gica...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 2: DIBUJO (CANVAS INTERACTIVO) -->
            <div id="trace" class="section">
                <h2>Visualizador de Trazos MPU-6050</h2>
                <div class="card">
                    <p>Replica visual del movimiento captado por la varita m√°gica en tiempo real.</p>
                    
                    <!-- Contenedor del Canvas -->
                    <div id="drawing-area" style="position: relative; overflow: hidden;">
                        <canvas id="wandCanvas" width="800" height="350"></canvas>
                        
                        <!-- Info superpuesta -->
                        <div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; color: var(--secondary-color);">
                            <span id="coords-display">X: 0 | Y: 0</span>
                        </div>
                    </div>

                    <div style="margin-top: 15px; text-align: center; display: flex; gap: 10px; justify-content: center;">
                        <button class="auth-btn" style="width: auto; background: #333;" onclick="clearCanvas()">
                            <span class="material-icons" style="vertical-align: middle; font-size: 1.1rem;">delete</span> Limpiar Lienzo
                        </button>
                        <button class="auth-btn" style="width: auto;" onclick="toggleDrawing()">
                            <span id="btn-draw-text">Pausar Dibujo</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 3: MQTT -->
            <div id="mqtt" class="section">
                <h2>Gesti√≥n de Dispositivos IoT</h2>
                <div class="card">
                    <h3>Agregar Nuevo Dispositivo</h3>
                    <div class="device-row">
                        <input type="text" placeholder="Nombre (ej. Foco)" class="auth-input" style="margin:0;">
                        <input type="text" placeholder="Topic MQTT" class="auth-input" style="margin:0;">
                        <button class="auth-btn" style="width: 100px; margin:0;">Agregar</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Dispositivos Conectados</h3>
                    <ul class="device-list" style="list-style: none; padding: 0;">
                        <li>
                            <span>üí° L√°mpara de Sala</span>
                            <span style="color: var(--success-color);">En l√≠nea</span>
                        </li>
                        <li>
                            <span>üîä Bocina Inteligente</span>
                            <span style="color: var(--success-color);">En l√≠nea</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- SECCI√ìN 4: TUTORIALES -->
            <div id="tutorials" class="section">
                <h2>Libro de Hechizos</h2>
                <div class="spell-grid">
                    <div class="spell-card">
                        <span class="spell-icon">‚¨Ü‚¨á</span>
                        <h3>Lumos / Nox</h3>
                        <p>L√≠nea vertical recta.</p>
                        <small>Control de Luz</small>
                    </div>
                    <div class="spell-card">
                        <span class="spell-icon">‚ö°</span>
                        <h3>Avada Kedavra</h3>
                        <p>Trazo en forma de rayo (Z).</p>
                        <small>Apagado de Emergencia</small>
                    </div>
                    <div class="spell-card">
                        <span class="spell-icon">‚Ü©</span>
                        <h3>Wingardium Leviosa</h3>
                        <p>Bucle y subida.</p>
                        <small>Levitar (Servo Motor)</small>
                    </div>
                     <div class="spell-card">
                        <span class="spell-icon">‚≠ï</span>
                        <h3>Stupefy</h3>
                        <p>Movimiento circular.</p>
                        <small>Aturdir / Detener</small>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 5: INFO -->
            <div id="info" class="section">
                <h2>Sobre el Proyecto</h2>
                <div class="card">
                    <h3>Mascota Rob√≥tica IoT & IA</h3>
                    <p>Este proyecto consiste en un peque√±o aut√≥mata controlado por una <strong>Raspberry Pi Zero 2 W</strong>. El sistema utiliza un control remoto con forma de "varita m√°gica" que funciona mediante gestos captados por un sensor <strong>MPU-6050</strong>.</p>
                    <p><strong>Objetivo:</strong> Servir de puente entre el usuario y dispositivos IoT, permitiendo controlar luces, sonido y movimientos mediante "hechizos" predefinidos.</p>
                    <p><strong>Tecnolog√≠as:</strong> Python (Flask, Pandas, Scikit-learn), MQTT, SQLite, HTML5 Canvas/CSS3.</p>
                </div>
            </div>

        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>